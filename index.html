<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultra Slideshow App — Phase 2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>

/* =============== GLOBAL VARIABLES ================= */
:root {
    --trans-speed: 1s;
    --fit: contain;
    --dash-mode: floating; /* floating | side | dock | editor */
}

/* =============== GLOBAL RESET ==================== */
body {
    margin: 0;
    overflow: hidden;
    background: #111;
    color: white;
    font-family: Arial, sans-serif;
}

/* =============== SLIDESHOW ======================== */
#slideshow {
    position: fixed;
    inset: 0;
    overflow: hidden;
}
.slide {
    position: absolute;
    inset: 0;
    opacity: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity var(--trans-speed) ease-in-out;
}
.slide.active { opacity: 1; }

.slide img, .slide iframe, .slide video {
    width: 100%;
    height: 100%;
    object-fit: var(--fit);
    border: none;
}

/* ======== TRANSITION CLASSES (Phase 2 Core Set) ======== */

/* FADE */
.fade-in { animation: fadeIn var(--trans-speed) ease; }
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

/* SLIDE LEFT */
.slide-left { animation: slideLeft var(--trans-speed) ease; }
@keyframes slideLeft { from{transform:translateX(100%);} to{transform:translateX(0);} }

/* SLIDE RIGHT */
.slide-right { animation: slideRight var(--trans-speed) ease; }
@keyframes slideRight { from{transform:translateX(-100%);} to{transform:translateX(0);} }

/* ZOOM IN */
.zoom-in { animation: zoomIn var(--trans-speed) ease; }
@keyframes zoomIn { from{transform:scale(1.3);} to{transform:scale(1);} }

/* ZOOM OUT */
.zoom-out { animation: zoomOut var(--trans-speed) ease; }
@keyframes zoomOut { from{transform:scale(0.7);} to{transform:scale(1);} }

/* BLUR TRANSITION */
.blur-in { animation: blurIn var(--trans-speed) ease; }
@keyframes blurIn { from{filter:blur(20px);} to{filter:blur(0);} }

/* WIPE */
.wipe { animation: wipe var(--trans-speed) ease; overflow:hidden; }
@keyframes wipe { from{clip-path:inset(0 100% 0 0);} to{clip-path:inset(0 0 0 0);} }

/* GLITCH (lightweight) */
.glitch { animation: glitch 0.6s linear; }
@keyframes glitch {
    0%,100% { clip-path: inset(0 0 0 0); }
    20% { clip-path: inset(10% 0 30% 0); }
    40% { clip-path: inset(40% 0 20% 0); }
    60% { clip-path: inset(5% 0 60% 0); }
}

/* KEN BURNS */
.kenburns { animation: kenburns 12s ease-in-out forwards; }
@keyframes kenburns {
    from { transform: scale(1) translate(0,0); }
    to   { transform: scale(1.25) translate(-20px, -20px); }
}

/* 3D CUBE */
.cube { animation: cube var(--trans-speed) ease; transform-style: preserve-3d; }
@keyframes cube {
    from { transform: rotateY(90deg); }
    to   { transform: rotateY(0deg); }
}

/* 3D FLIP */
.flip { animation: flip var(--trans-speed) ease; transform-style: preserve-3d; }
@keyframes flip {
    from { transform: rotateY(-180deg); }
    to   { transform: rotateY(0deg); }
}

/* ============= CAPTION + DESCRIPTION PANEL ================= */
#caption-bar {
    position: fixed;
    bottom: 0;
    width: 100vw;
    background: rgba(0,0,0,0.4);
    padding: 10px;
    text-align: center;
}
#description-panel {
    position: fixed;
    right: 0;
    top: 100px;
    width: 300px;
    height: 60vh;
    background: rgba(0,0,0,0.6);
    padding: 10px;
    overflow-y: auto;
    display: none;
}

/* ============= DASHBOARD ========================== */
#dashboard {
    position: fixed;
    background: rgba(20,20,20,0.9);
    padding: 15px;
    color: white;
    border-radius: 10px;
    z-index: 9999;
    width: 320px;
    max-height: 80vh;
    overflow-y: auto;
}

/* Floating Mode */
body[data-dash="floating"] #dashboard {
    left: 20px; top: 20px;
}

/* Side Panel Mode */
body[data-dash="side"] #dashboard {
    left: 0; top: 0; bottom: 0;
    width: 300px; border-radius: 0;
}

/* Dock Mode */
body[data-dash="dock"] #dashboard {
    left: 0; right: 0; bottom: 0;
    width: 100%; height: 180px;
    border-radius: 0;
}

/* Editor Mode (full split view) */
body[data-dash="editor"] #dashboard {
    left: 0; top: 0; bottom: 0;
    width: 30vw; border-radius: 0;
}
    
<h3>Add Embeds / Links</h3>
<textarea id="embed-input" placeholder="Paste embed code, URL, YouTube link, etc." 
style="width:100%; height:80px;"></textarea>
<button onclick="addEmbed()">Add Embed</button>
<br><br>

    <h3>Upload Media</h3>
<!-- Images and Videos -->
<input type="file" id="media-upload" multiple accept="image/*,video/*"><br><br>

<!-- Audio Upload -->
<input type="file" id="music-upload" multiple accept="audio/*"><br><br>

<!-- Embeds / Links -->
<textarea id="embed-input" placeholder="Paste embed code, URL, YouTube link, etc." 
style="width:100%; height:80px;"></textarea>
<button onclick="addEmbed()">Add Embed</button><br><br>

/* ============= TIMELINE =========================== */
#timeline {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 80px;
    background: rgba(0,0,0,0.7);
    overflow-x: auto;
    white-space: nowrap;
}
.timeline-item {
    display: inline-block;
    width: 80px;
    height: 60px;
    margin: 10px;
    background: #333;
    border: 2px solid #444;
    cursor: grab;
}
.timeline-item.active { border-color: yellow; }
.timeline-item img { width: 100%; height: 100%; object-fit: cover; }

/* ============= FILTERS PANEL ====================== */
.filter-slider { width: 100%; }

/* ============= AUDIO PLAYER ======================== */
#audio-player {
    position: fixed;
    top: 0;
    right: 0;
    width: 250px;
    background: rgba(0,0,0,0.5);
    padding: 10px;
}

</style>
</head>
<body data-dash="floating">

<div id="slideshow"></div>
<div id="caption-bar"></div>
<div id="description-panel"></div>
<div id="timeline"></div>

<div id="audio-player">
    <strong>Music Playlist</strong><br>

    <!-- Audio element -->
    <audio id="bgm" controls></audio><br><br>

    <!-- Upload audio files -->
    <input type="file" id="music-upload" accept="audio/*" multiple><br><br>

    <!-- Track list -->
    <div id="track-list" style="max-height:150px; overflow-y:auto;"></div>

    <button onclick="prevTrack()">Prev Track</button>
    <button onclick="nextTrack()">Next Track</button>
</div>

<!-- ================= DASHBOARD UI ================== -->
<div id="dashboard">

<h2>Control Dashboard</h2>

<!-- DASHBOARD MODE SWITCH -->
<label><strong>Dashboard Layout</strong></label><br>
<select onchange="setDashboardMode(this.value)">
    <option value="floating">Floating</option>
    <option value="side">Side Panel</option>
    <option value="dock">Bottom Dock</option>
    <option value="editor">Editor Layout</option>
</select><br><br>

<!-- TRANSITIONS -->
<label><strong>Transition</strong></label><br>
<select id="transitionSelect">
    <option value="fade-in">Fade</option>
    <option value="slide-left">Slide Left</option>
    <option value="slide-right">Slide Right</option>
    <option value="zoom-in">Zoom In</option>
    <option value="zoom-out">Zoom Out</option>
    <option value="blur-in">Blur</option>
    <option value="wipe">Wipe</option>
    <option value="glitch">Glitch</option>
    <option value="kenburns">Ken Burns</option>
    <option value="cube">3D Cube</option>
    <option value="flip">3D Flip</option>
</select><br><br>

<!-- FILTERS -->
<h3>Filters</h3>
<label>Brightness</label><input type="range" min="50" max="150" value="100" class="filter-slider" id="bright"><br>
<label>Contrast</label><input type="range" min="50" max="200" value="100" class="filter-slider" id="contrast"><br>
<label>Saturation</label><input type="range" min="0" max="200" value="100" class="filter-slider" id="saturate"><br>
<label>Hue</label><input type="range" min="0" max="360" value="0" class="filter-slider" id="hue"><br>
<label>Blur</label><input type="range" min="0" max="10" value="0" class="filter-slider" id="blur"><br>

<br>

<!-- UPLOAD -->
<h3>Add Slides</h3>
<input type="file" id="files" multiple>

</div>

<script>

/* ============================================================
   PHASE 2 ULTRA JAVASCRIPT ENGINE
============================================================ */

let slides = [];
let current = 0;
let filters = {bright:100, contrast:100, saturate:100, hue:0, blur:0};
let musicList = [];
let trackIndex = 0;

/* ============= FILTER ENGINE ================== */
function applyFilters() {
    let f = `
        brightness(${filters.bright}%)
        contrast(${filters.contrast}%)
        saturate(${filters.saturate}%)
        hue-rotate(${filters.hue}deg)
        blur(${filters.blur}px)
    `;
    document.querySelectorAll('.slide').forEach(s => {
        s.style.filter = f;
    });
}

['bright','contrast','saturate','hue','blur'].forEach(id=>{
    document.getElementById(id).oninput = e=>{
        filters[id] = e.target.value;
        applyFilters();
    };
});

/* ============= DASHBOARD MODE SWITCH ============== */
function setDashboardMode(mode) {
    document.body.dataset.dash = mode;
}

/* ============= CREATE SLIDE ======================= */
function createSlide(type, src, caption="", desc="") {
    const s = document.createElement("div");
    s.className = "slide";

    let el;
    if(type==="img") {
        el = document.createElement("img");
        el.src = src;
    } else if(type==="video") {
        el = document.createElement("video");
        el.src = src; 
        el.autoplay=true; 
        el.loop=true; 
        el.muted=true; 
        el.controls=true;
    }

    s.appendChild(el);
    document.getElementById("slideshow").appendChild(s);

    slides.push({ type, src, caption, desc });
    addTimelineThumb(src);

    if(slides.length===1) showSlide(0);
}

/* ============= TIMELINE =========================== */
function addTimelineThumb(src) {
    const t = document.createElement("div");
    t.className = "timeline-item";

    // For images, show thumbnail; for video/other, use placeholder
    if(src.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
        t.innerHTML = `<img src="${src}">`;
    } else {
        t.innerHTML = `<div style="background:#444;color:white;font-size:10px;text-align:center;padding-top:20px;">Media</div>`;
    }

    t.onclick = ()=>showSlide([...t.parentNode.children].indexOf(t));
    document.getElementById('timeline').appendChild(t);
}

/* ============= SHOW SLIDE ========================= */
function showSlide(i) {
    current = (i+slides.length)%slides.length;
    document.querySelectorAll('.slide').forEach((s,idx)=>{
        s.classList.toggle('active', idx===current);
        s.classList.remove(
            'fade-in','slide-left','slide-right','zoom-in','zoom-out',
            'blur-in','wipe','glitch','kenburns','cube','flip'
        );
        if (idx===current) {
            let tr = document.getElementById('transitionSelect').value;
            s.classList.add(tr);
        }
    });

    /* captions */
    document.getElementById('caption-bar').innerText = slides[current].caption||"";

    /* description */
    document.getElementById('description-panel').innerText = slides[current].desc||"";

    /* timeline highlight */
    document.querySelectorAll('.timeline-item').forEach((t,idx)=>{
        t.classList.toggle('active', idx===current);
    });
}

/* ============= FILE UPLOAD ======================== */
document.getElementById('files').onchange = e=>{
    [...e.target.files].forEach(file=>{
        let url = URL.createObjectURL(file);
        if (file.type.startsWith('image')) createSlide("img",url,file.name);
        if (file.type.startsWith('video')) createSlide("video",url,file.name);
        if (file.type==="text/plain") {
            let r = new FileReader();
            r.onload=ev=>{
                ev.target.result.split("\n").forEach(l=>{
                    if (l.trim()) createSlide("iframe", l.trim());
                });
            };
            r.readAsText(file);
        }
    });
};

    if (file.type.startsWith("video")) {
    let url = URL.createObjectURL(file);
    createSlide("video", url, file.name);
}

/* ============= AUDIO PLAYLIST ====================== */
function nextTrack() {
    if (musicList.length===0) return;
    trackIndex = (trackIndex+1)%musicList.length;
    document.getElementById('bgm').src = musicList[trackIndex];
}

document.getElementById('bgm').onended = nextTrack;

/* ======= Basic Left/Right Navigation =============== */
document.onkeydown = e=>{
    if (e.key==="ArrowRight") showSlide(current+1);
    if (e.key==="ArrowLeft") showSlide(current-1);
};

    /* ============================================================
   MUSIC PLAYLIST ENGINE — (Phase 2 Ultra Upgrade)
============================================================ */

let musicList = [];
let trackIndex = 0;

/* Update track list visually */
function refreshTrackList() {
    const list = document.getElementById("track-list");
    list.innerHTML = "";

    musicList.forEach((track, i) => {
        const div = document.createElement("div");
        div.style.padding = "5px";
        div.style.cursor = "pointer";
        div.style.background = i === trackIndex ? "rgba(255,255,0,0.2)" : "transparent";

        div.innerText = (i+1) + ". " + track.name;
        div.onclick = () => {
            trackIndex = i;
            playCurrentTrack();
        };

        list.appendChild(div);
    });
}

/* Load and play the current track */
function playCurrentTrack() {
    const audio = document.getElementById("bgm");
    if (musicList.length === 0) return;

    audio.src = musicList[trackIndex].url;
    audio.play();
    refreshTrackList();
}

/* Next track */
function nextTrack() {
    if (musicList.length === 0) return;
    trackIndex = (trackIndex + 1) % musicList.length;
    playCurrentTrack();
}

/* Previous track */
function prevTrack() {
    if (musicList.length === 0) return;
    trackIndex = (trackIndex - 1 + musicList.length) % musicList.length;
    playCurrentTrack();
}

/* Auto-next when a track ends */
document.getElementById("bgm").onended = nextTrack;

/* Upload music files */
document.getElementById("music-upload").onchange = (e) => {
    [...e.target.files].forEach(file => {
        if (file.type.startsWith("audio/")) {
            const url = URL.createObjectURL(file);
            musicList.push({ name: file.name, url });
        }
    });

    refreshTrackList();

    // Auto-play first track if none playing
    if (musicList.length === 1) {
        playCurrentTrack();
    }
};

    /* ============================================================
   EMBEDS + LINK PREVIEW + VIDEO LINK ENGINE
============================================================ */

function addEmbed() {
    const raw = document.getElementById("embed-input").value.trim();
    if (!raw) return;

    // CASE 1 — Raw embed code (iframe, script, HTML blocks)
    if (raw.startsWith("<")) {
        createEmbedSlide(raw, "Custom Embed");
        document.getElementById("embed-input").value = "";
        return;
    }

    // CASE 2 — YouTube Link
    if (raw.includes("youtube.com") || raw.includes("youtu.be")) {
        const id = extractYouTubeID(raw);
        if (id) {
            createEmbedSlide(
                `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}" frameborder="0" allowfullscreen></iframe>`,
                "YouTube"
            );
            document.getElementById("embed-input").value = "";
            return;
        }
    }

    // CASE 3 — Vimeo Link
    if (raw.includes("vimeo.com")) {
        const id = raw.split("/").pop();
        createEmbedSlide(
            `<iframe src="https://player.vimeo.com/video/${id}" frameborder="0" allowfullscreen></iframe>`,
            "Vimeo"
        );
        document.getElementById("embed-input").value = "";
        return;
    }

    // CASE 4 — Video File URL
    if (raw.match(/\.(mp4|webm|ogg|mov)$/i)) {
        createSlide("video", raw, "Video Link");
        document.getElementById("embed-input").value = "";
        return;
    }

    // CASE 5 — Generic Website URL → Auto Link Preview
    createLinkPreviewSlide(raw);
    document.getElementById("embed-input").value = "";
}
    
/* Extract YouTube Video ID */
function extractYouTubeID(url) {
    let id = null;

    if (url.includes("youtu.be/"))
        id = url.split("youtu.be/")[1].split(/[?&]/)[0];

    if (url.includes("watch?v="))
        id = url.split("watch?v=")[1].split("&")[0];

    return id;
}

/* Create a raw embed slide */
function createEmbedSlide(html, caption="Embed") {
    const s = document.createElement("div");
    s.className = "slide";
    s.innerHTML = html;

    document.getElementById("slideshow").appendChild(s);
    slides.push({ type:"embed", html, caption, desc:"" });

    addTimelineThumbFromHTML(html);
    if (slides.length===1) showSlide(0);
}

/* Create a link preview slide */
function createLinkPreviewSlide(url) {
    const previewHTML = `
        <div style="width:100%; height:100%; background:#222; display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; padding:20px;">
            <h2>Preview: ${url}</h2>
            <iframe src="${url}" style="flex:1; width:90%; border:0;"></iframe>
        </div>
    `;
    createEmbedSlide(previewHTML, "Link Preview");
}

/* Thumbnail for non-image items */
function addTimelineThumbFromHTML(html) {
    const t = document.createElement("div");
    t.className = "timeline-item";
    t.innerHTML = `<div style="background:#444; color:white; font-size:10px; text-align:center; padding-top:20px;">Embed</div>`;
    t.onclick = ()=>showSlide([...t.parentNode.children].indexOf(t));
    document.getElementById('timeline').appendChild(t);
}

    /* ============================================================
   MEDIA UPLOAD HANDLER — Images + Videos + Embeds
============================================================ */

document.getElementById("media-upload").onchange = function(e){
    const files = [...e.target.files];
    files.forEach(file => {
        const url = URL.createObjectURL(file);
        if(file.type.startsWith("image/")) {
            createSlide("img", url, file.name);
        } else if(file.type.startsWith("video/")) {
            createSlide("video", url, file.name);
        }
    });
};

</script>
</body>
</html>
